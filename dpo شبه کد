# شبه شکد
  for x , y_pos , y_neg in data:

    logp_pos = policy_model.log_prob(x, y_pos)
    logp_neg = policy_model.log_prob(x , y_neg)

    logp_pos_ref = ref_model.log_prob(x, y_pos)
    logp_neg_ref = ref_model.log_prob(x, y_neg)

    diff_policy = logp_pos - logp_neg
    diff_ref = logp_pos_ref - logp_neg_ref

    z = beta * (diff_policy - diff_ref)

    loss = -log_sigmoid(z)

    loss.backward()
    optimizer.step()
    optimizer.zero_grad()
